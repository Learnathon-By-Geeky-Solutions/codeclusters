name: Build 
 
on: 
   push:
       branches: [main]
   pull_request:
       types: [opened, synchronize, reopened]
           
 
 
 
jobs:
  sonarcloud:
     name: Analyze with SonarCloud
     runs-on: ubuntu-latest
     steps:
       - name: Checkout repository
         uses: actions/checkout@v3
         with:
           fetch-depth: 0  # Needed for SonarCloud to analyze the code properly
 
       - name: Setup Node.js
         uses: actions/setup-node@v3
         with:
           node-version: 20
 
       - name: Install frontend dependencies
         working-directory: frontend
         run: npm install


       - name: Install admin dependencies
         working-directory: admin
         run: npm install
 
       - name: Install backend dependencies
         working-directory: backend
         run: npm install
 
       - name: SonarCloud Scan
         uses: SonarSource/sonarcloud-github-action@v2
         with:
           args: >
             -Dsonar.token=${{ secrets.SONAR_TOKEN }}
             -Dsonar.projectKey=Learnathon-By-Geeky-Solutions_codeclusters
             -Dsonar.organization=learnathon-by-geeky-solutions
             -Dsonar.projectName="codeclusters"
             -Dsonar.sources=frontend/src,backend,admin/src
             -Dsonar.javascript.lcov.reportPaths=admin/coverage/lcov.info
             -Dsonar.typescript.lcov.reportPaths=admin/coverage/lcov.info
             -Dsonar.exclusions=**/node_modules/**,**/dist/**,**/coverage/**,
             -Dsonar.coverage.exclusions=**/test/**,**/mock/**
             -Dsonar.ci.enabled=true
             -Dsonar.analysis.automatic=false
         env:
           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
           
